# 用户认证表初始化指南

## 📋 问题描述

当前遇到的API错误：`FieldNameNotFound` - 字段名 'phone' 不存在

这是因为用户认证表还没有创建或字段结构不匹配。

## 🔧 解决方案：手动创建用户认证表

### 第一步：打开飞书多维表格

1. 访问 [飞书多维表格](https://base.feishu.cn/)
2. 使用你的飞书账号登录

### 第二步：创建新的多维表格应用

1. 点击"创建空白多维表格"
2. 应用名称：`用户认证数据库`
3. 创建成功后，记录下应用的 `app_token`（在URL中可以找到）

### 第三步：创建用户信息表

在新建的应用中创建表格，表名：`用户信息表`

### 第四步：设置表格字段

按照以下顺序创建字段：

| 字段名 | 字段类型 | 说明 | 是否必填 |
|--------|----------|------|----------|
| `phone` | 文本 | 用户手机号 | ✅ 必填 |
| `name` | 文本 | 用户姓名 | ✅ 必填 |
| `user_type` | 单选 | 用户类型 | ✅ 必填 |
| `created_time` | 日期时间 | 创建时间 | ✅ 必填 |
| `last_login_time` | 日期时间 | 最后登录时间 | ✅ 必填 |
| `status` | 单选 | 用户状态 | ✅ 必填 |

#### 单选字段配置

**user_type 字段选项：**
- 老师
- 家长  
- 管理员

**status 字段选项：**
- 正常
- 禁用

### 第五步：更新环境变量

1. 找到新创建的应用的 `app_token`
2. 找到用户信息表的 `table_id`
3. 更新 `.env.local` 文件：

```env
# 用户认证表配置
FEISHU_USER_TABLE_APP_TOKEN=你的新app_token
FEISHU_USER_TABLE_ID=你的新table_id
```

### 第六步：重启开发服务器

```bash
# 停止当前服务器（Ctrl+C）
# 重新启动
npm run dev
```

## 📝 获取Token的方法

### 获取 app_token
- 在多维表格的URL中：`https://base.feishu.cn/base/{app_token}/...`
- 复制 `{}` 中的部分

### 获取 table_id  
- 点击进入具体表格，URL中：`https://base.feishu.cn/base/{app_token}/{table_id}/...`
- 复制第二个路径参数

## 🚨 注意事项

1. **字段名必须使用英文**：确保字段名完全匹配（phone, name, user_type等）
2. **权限设置**：确保飞书应用有表格的读写权限
3. **表格共享**：如果是团队使用，需要设置适当的共享权限

## ✅ 验证设置

创建完成后，可以手动添加一条测试数据：

| phone | name | user_type | status |
|-------|------|-----------|--------|
| 13800138000 | 测试用户 | 家长 | 正常 |

然后重新访问登录页面测试。

## 🔄 自动化创建（可选）

如果你有管理员权限，也可以运行以下命令自动创建：

```bash
# 注意：需要先配置用户访问令牌
npm run create-user-table
``` 